# Telegram-бот с “памятью” (Pinecone)

Telegram-бот на Python, который **сохраняет историю диалогов в Pinecone** (через эмбеддинги) и при каждом новом сообщении **достаёт релевантный контекст семантическим поиском**, чтобы ответы LLM были более “помнящими”.

## Возможности

- **Долгосрочная память**: сообщения пользователя и ответы бота сохраняются в Pinecone
- **Контекстные ответы**: для нового сообщения подмешивается найденный контекст из истории
- **Изоляция пользователей**: отдельный `namespace` на пользователя
- **Дедупликация**: защита от повторного сохранения одинаковых сообщений
- **Команды**: `/start`, `/help`, `/stats`, `/clear`

## Стек

- Python 3.8+
- `pyTelegramBotAPI`
- OpenAI API (через `openai`)
- Pinecone (через `pinecone`)

## Быстрый старт (Windows / PowerShell)

1) Создайте виртуальное окружение и установите зависимости:

```bash
py -m venv .venv
.\.venv\Scripts\activate
pip install -r requirements.txt
```

2) Создайте файл `.env` из примера и заполните ключи:

```bash
copy .env.example .env
```

3) Запустите бота:

```bash
python telegram_bot.py
```

## Конфигурация

Переменные окружения (см. `.env.example`):

- `OPENAI_API_KEY`
- `OPENAI_BASE_URL` (опционально, если используете прокси/совместимый endpoint)
- `PINECONE_API_KEY`
- `PINECONE_INDEX_NAME`
- `TELEGRAM_BOT_TOKEN`

## Структура проекта

- `telegram_bot.py`: обработка сообщений/команд Telegram + интеграция OpenAI/Pinecone
- `pinecone_manager.py`: слой работы с Pinecone (сохранение, поиск, дедупликация)

## Заметки

- Индекс Pinecone создаётся/проверяется ботом автоматически (если настроено в коде).
- Логи пишутся в `telegram_bot.log` (файл игнорируется git).

## Безопасность

- **Никогда не коммитьте `.env`**. В репозитории должен быть только шаблон `.env.example`.
- Перед публикацией проверьте, что секреты не попали в историю коммитов. Если ключи где-то “засветились” — **сразу ротируйте**: Telegram token через BotFather, OpenAI/Pinecone ключи — в кабинетах сервисов.

## Лицензия

MIT
